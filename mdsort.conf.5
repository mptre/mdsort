.Dd $Mdocdate: March 17 2018 $
.Dt MDSORT.CONF 5
.Os
.Sh NAME
.Nm mdsort.conf
.Nd mdsort configuration file
.Sh DESCRIPTION
.Nm
is the configuration file for
.Xr mdsort 1 .
.Pp
Comments can be put anywhere in the file using a hash mark
.Pq Sq #
and extend to the end of the current line.
.Pp
The configuration starts with one or many maildir definitions:
.Bl -tag -width Ds
.It Ic maildir Do Ar path Dc No { Ar rule ... No }
A maildir rooted in
.Ar path ;
.Xr mdsort 1
iterates over each message present in the
.Pa cur
and
.Pa new
directory and evaluates each rule in sequential order.
The first matching rule is favored.
.It Ic stdin No { Ar rule ... No }
Accepts a message from stdin and evaluates each rule in sequential order.
The first matching rule is favored.
This type of maildir will only be evaluted if
.Xr mdsort 1
is invoked with the stdin option.
.El
.Pp
Each maildir is followed by a block of rules.
A rule is defined as follows:
.Bl -tag -width XXX
.It Ic match Ar condition action ...
A rule starts with the
.Ic match
keyword followed by a condition then actions to perform if the condition
evaluates to true.
Each rule spans to the end of the current line but can extended over multiple
lines using a backslash
.Pq Sq \e .
.Pp
A
.Ar pattern
used within a condition is interpreted as an extended regular expression and can
be made case insensitive using the
.Sq i
keyword.
.Pp
The conditions are as follows and may be negated:
.Bl -tag -width Ds
.It Oo Ic \&! Oc Ic body No / Ns Ar pattern Ns / Ns Op i
Evaluates to true if the message body matches
.Ar pattern .
.It Xo Op Ic \&!
.Ic header Dq Ar name
.Pf / Ar pattern Ns Pf / Op i
.Xc
.It Xo Op Ic \&!
.Ic header No { Do Ar name Dc Ar ... No }
.Pf / Ar pattern Ns Pf / Op i
.Xc
Evaluates to true if the value of any of the headers with
.Ar name
in message matches
.Ar pattern .
Finding the header with
.Ar name
in message is done case insensitive.
.It Xo Op Ic \&!
.Ic attachment
.Xc
Evaluates to true if the message has attachments.
.It Xo Op Ic \&!
.Ic attachment
.Pf / Ar pattern Ns Pf / Op i
.Xc
Evaluates to true if the message has attachments with a content type matching
.Ar pattern .
.It Xo Op Ic \&!
.Ic date \&> Ar age scale
.Xc
.It Xo Op Ic \&!
.Ic date \&< Ar age scale
.Xc
Evalutes to true if the date header in message is either greater or less than
.Ar age ,
which must be a positive number.
The
.Ar scale
must be either
.Ic seconds , minutes , hours , days , weeks , months
or
.Ic years .
It may be abbreviated in a non-ambiguous way, such as
.Ic second
or
.Ic s .
.It Xo Op Ic \&!
.Ic all
.Xc
Evaluates to true for any message.
.It Xo Op Ic \&!
.Ic new
.Xc
Evaluates to true if the message is not read.
.It Xo Op Ic \&!
.Ic old
.Xc
Evaluates to true if the message is old.
Meaning, a message that has been read but later flagged as not read.
.El
.Pp
Multiple and nested conditions may be also specified:
.Bl -tag -width Ds
.It Ar condition Ic and Ar condition
Evaluates to true if both
.Ar condition
are true.
.It Ar condition Ic or Ar condition
Evaluates to true if any of the
.Ar condition
are true.
.It Xo Op Ic \&!
.Ic \&( Ar condition Ic \&)
.Xc
Evaluates to true if the nested
.Ar condition
is true.
.El
.Pp
Next comes one or many actions:
.Bl -tag -width Ds
.It Ic discard
Remove the message from the maildir.
Mutually exclusive with all other actions.
.It Ic flag Oo Ic \&! Oc Ic new
Flag the message as read or not.
.It Ic move Dq Ar path
Move the message to the maildir located at
.Ar path .
The
.Ar path
may contain back-references on the form
.Sq \e#
where
.Sq #
is a digit.
The digit refers to the nth subexpression of the first matching
.Ar pattern
and will be replaced with matched string.
Note, using back-references with many
.Ic or
conditions is not encouraged since the
.Ar pattern
that matches first may vary.
.Pp
Only one
.Ic move
action can be defined per rule.
.It Ic pass
Abort evaluation of the current block of rules.
Especially useful when using nested
.Ic match
blocks.
Mutually exclusive with all other actions.
.El
.It Ic match Ar condition No { Ar rule ... No }
The nested block of rules
is only evaluated if
.Ar condition
is true.
.El
.Sh FILES
.Bl -tag -width "~/.mdsort.conf"
.It Pa ~/.mdsort.conf
The default configuration file.
.El
.Sh EXAMPLES
.Bd -literal
maildir "~/Maildir/INBOX" {
	# Move messages from OpenBSD mailing lists into dedicated directories.
	match header { "Cc" "To" } /(bugs|misc|ports|tech)@openbsd.org/i \e
		move "~/Maildir/openbsd-\e1"

	# Get rid of potential spam.
	match header "Received-SPF" /fail/ or header "X-Spam-Score" /[1-9]/ \e
		move "~/Maildir/Spam"

	# Archive read messages.
	match ! new move "~/Maildir/Archive"
}

maildir "~/Maildir/Trash" {
	# Delete messages older than 2 weeks.
	match date > 2 weeks discard
}

# Accept messages from stdin and move to the invoking user's inbox.
stdin {
	match all move "~/Maildir/INBOX"
}
.Ed
.Sh SEE ALSO
.Xr mdsort 1 ,
.Xr re_format 7
.Sh AUTHORS
.An Anton Lindqvist Aq Mt anton@basename.se
